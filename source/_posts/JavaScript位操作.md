---
title: JavaScript位操作
date: 2019-07-09 01:25:20
tags:
categories:
- 前端
---
JavaScript中的数字都按照IEEE-754标准以64位格式存储。在位操作中，数字被转换为有符号32位格式。每次运算符会直接操作该32位数以得到结果。虽然需要转换，但这个过程与JavaScript其他数学运算和布尔操作相比要快很多。

**1、& 按位与**
&是二元运算符，它以特定的方式的方式组合操作数中对应的位，如果对应的位都为1，那么结果就是1， 如果任意一个位是0 则结果就是0。

1 & 3的结果为1

那我们来看看他是怎么运行的

1的二进制表示为 0 0 0 0 0 0 1

3的二进制表示为 0 0 0 0 0 1 1

根据 & 的规则 得到的结果为 0 0 0 0 0 0 0 1,十进制表示就是1

**2、| 按位或**

|运算符跟&的区别在于如果对应的位中任一个操作数为1 那么结果就是1。

1的二进制表示为 0 0 0 0 0 0 1

3的二进制表示为 0 0 0 0 0 1 1

所以 1 | 3的结果为3

**3、^ 按位异或**
^运算符跟|类似，但有一点不同的是 如果两个操作位都为1的话，结果产生0。

1的二进制表示为 0 0 0 0 0 0 1

3的二进制表示为 0 0 0 0 0 1 1

所以 1 ^ 3的结果为2

**4、~ 按位非**
~运算符是对位求反，1变0,0变1，也就是求二进制的反码

1的二进制表示为 0 0 0 0 0 0 1

所以 ~1 的结果是-2

**5、>> 右移**
`>>`运算符使指定值的二进制所有位都右移规定的次数，对于其移动规则只需记住符号位不变，左边补上符号位即按二进制形式把所有的数字向右移动对应的位数，低位移出(舍弃)，高位的空位补符号位，即正数补零，负数补1。

1的二进制表示为 0 0 0 0 0 0 1

所以 1>>1的结果为0

**6、<< 左移**
`<<`运算符使指定值的二进制所有位都左移规定的次数，对于其移动规则只需记住丢弃最高位，0补最低位即按二进制形式把所有的数字向左移动对应的位数，高位移出(舍弃)，低位的空位补零。

1的二进制表示为 0 0 0 0 0 0 1

所以 1<<1的结果为2 7、>>> 无符号右移

***
***
所有整数字面量都是有符号整数，用31位表示数值，用第32位表示符号，0表示正数1表示负数。数值范围从-(2^31 - 1)到(2^31 - 1)。注意位0的位置在最右侧。

0是所有位为0

-1是所有位为1

-2147483648是除了最左边为1，其他都是0

2147483647是除了最左边为0外，其他都是1的整数。

正数是以真二进制形式存储的，前 31 位中的每一位都表示 2 的幂，从第 1 位（位 0）开始，表示 2^0，第 2 位（位 1）表示 2^1。没用到的位用 0 填充，即忽略不计。
```
var num = 18;
(num).toString(2); //10010（18 = 2^4+2^1）
```
负数也存储为二进制代码，不过采用的形式是二进制补码

直接来例子，求-18的补码
>（1）求该数字非负版本的二进制。这里也就是18的二进制（10010）
（2）求二进制反码，也就是1变成0，0变成1（1111 1111 1111 1111 1111 1111 1110 1101）
（3）在反码的基础上加一，注意二进制里的运算1+1=10（1111 1111 1111 1111 1111 1111 1110 1110）

但是呢，ECMAScript并不以这种二进制补码来表示负数，而是用数字绝对值的标准二进制代码前面加上负号的形式输出。
```
var num = -18;
(num).toString(2); //-10010,“-18的显示就是这样的”
```
位运算符
与 & 两个都为1 结果才为1

保持数位对齐，用上述规则然后进行与运算。

或 | 两个都为0时，结果才为0

保持数位对齐，用上述规则然后进行或运算。

非 ~ 0变1，1变0

其实就是对数字求负，然后减一
```
var num = 25;
var num1 = ~num;
num1; //-26
```
异或 ^ 两个相同为0，不同为1

满足交换律，一个数和自己异或的结果是0，任何数x与0异或的结果都是本身x，任何数x与-1异或的结果都是-x。

左移 << 各二进位全部左移若干位，高位丢弃，右侧低位补0
```
var old = 2; //10
var new = old << 5; //1000000
```
右移 >> 各二进位全部右移若干位，有符号数，用符号位的值填充这些空位。

##一些小技巧
（1）判断奇偶（貌似很实用啊）
```
//一般都是(i % 2 !== 0)来判断奇数
if(i & 1) {
//奇数需要进行的事情
} else {
//偶数需要做的事情
}
```
（2）交换两个数字

一般需要一个中间变量，
```
var temp = a;
var a = b;
var b = temp;
```
可以用位操作符实现交换不需要中间变量
```
a ^= b; //a = a ^ b
b ^= a; //b = b ^ a = b ^ a ^ b = a (b = a)
a ^= b; //a = a ^ b = a ^ b ^ a = b;
```
（3）变换符号

只需要求反后加1即可
```
function rever (n) {
return ~n + 1;
} //11 => -11
```
（4）求绝对值

对于负数对其取反后加1来得到正数。先移位取得符号位i >> 31
```
var i = a >> 31 //如果a为正数，i为0。如果a为负数，i为-1
return i == 0 ? a : (~a + 1); //正数保持不变，负数变换符号。
```
另一种方法
可以通过异或，参考异或的规则。a与i异或后减i（即加0或者加1）
```
var i = a >> 31;
return (a ^ i) - i;
```
